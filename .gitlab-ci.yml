image: rocker/verse

test:
  script:
    - R -e "sessionInfo()"
    - "Rscript -e \"deps <- remotes::dev_package_deps(dependencies = NA); needs <- deps$package; remotes::install_deps(dependencies = TRUE); ip <- as.data.frame(installed.packages()); got <- ip$Package; message('deps = ', class(deps), ', ip = ', class(ip), ', needs = ', class(needs), ', got = ', class(got)); if (! all(needs %in% got)) { message('missing: ', paste(setdiff(needs, got), collapse = ', ')); quit(save = 'n', status = 1)};\""
    - R CMD build .
    - PKG_FILE_NAME=$(ls -1t *.tar.gz | head -n 1)
    - R CMD check "${PKG_FILE_NAME}" --as-cran
