language: r
sudo: false
cache: packages

matrix:
  include:
    - name: release
      r: release
      r_check_args: --as-cran --no-build-vignettes
    - name: devel
      r: devel
      r_check_args: --as-cran --no-build-vignettes --use-valgrind
      env:
        - VALGRIND_OPTS='--leak-check=full --track-origins=yes'
      addons:
        apt:
          packages:
            - valgrind

r_build_args: --no-resave-data --no-build-vignettes
script:
  - if ! test -d inst/doc; then mkdir inst/doc; fi
  - rm -r inst/doc/*
  - cp -R doc/* inst/doc/
  - cp -R Meta/* inst/doc/
  - R CMD build ${R_BUILD_ARGS} .
  - travis_wait R CMD check "${PKG_TARBALL}" ${R_CHECK_ARGS}; CHECK_RET=$?
